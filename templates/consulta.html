{% extends "base.html" %}
{%block datos %}
<head>  
  <link type="text/css" href="media/css/consulta.css" rel="stylesheet" />
  <link type="text/css" href="media/cupertino/ui.all.css" rel="stylesheet" />  
</head>
<style type="text/css">
.botonWide { margin:10px 10px 10px 10px;width:120px;} 
.tabla { width:616px; }

#dialogoNombre { font-size:180%; }
</style>
<body style="font-size:62.5%;">
  
<div id="tabs">
    <ul>
        <li><a href="#fragment-1"><span>Consulta</span></a></li>
        <li><a href="#fragment-2"><span>Receta</span></a></li>
        <li><a href="#fragment-3"><span>Estudios</span></a></li>
    </ul>
    <div id="fragment-1">
        <label>Nombre</label>
		<input id="nombre"></input>
        <label>Paterno</label>
		<input id="paterno"></input>
        <label>Materno</label>
		<input id="materno"></input>		
		<Button id="buscar" class="buscar" onclick="buscoNombre()">Buscar</Button>
		<br><br>
		<hr>
		<label>Sintoma</label>
		<input id="sintoma" class="largeInput" ></input>
		<Button id="agregarSintoma" onclick="AgregoSintoma()">Agregar</Button>
		
		<SELECT id="datosSintomas" NAME="datosSintomas" MULTIPLE class="input">
		
		</SELECT>
			      <table>
		<tr style="text-align:center" >		   
			<td><Button class="widebuttons buscar" id="BorrarSintoma" onclick="BorroUno('#datosSintomas')" class="buscar">Borrar Sintoma</Button></td>
			<td><Button class="widebuttons buscar" id="LimpiarSintoma" onclick="BorroTodos('#datosSintomas')" class="buscar">Limpiar Sintomas</Button></td>
		   
		</tr>
		</table>
		<br><br>
		<hr>
		<label>Diagnostico</label><br>
		<TEXTAREA NAME="comments"id="diagnostico" class="input"></TEXTAREA>
		<Button id="grabar" class="widebuttons buscar" onclick="GraboConsulta()">Grabar</Button>
    
    </div>
    <div id="fragment-2">
		<table>
		<tr>
		<td><label>Prescripci&oacute;n</label></td>
		<td><input id="prescripcion" class="largeInput" ></input></td>
		</tr>
		<tr>
		<td><label>Dosis</label></td>
		<td><input id="dosis" class="largeInput" ></input></td>
		</tr></table>		
		<Button id="agregarMedicina" onclick="AgregoMedicina()" class="buscar">Agregar</Button>
		<br><br>		
		<SELECT id="datosMedicinas" NAME="datosMedicinas" MULTIPLE class="input">
		
		</SELECT>
		<table>
		<tr>
			<td><Button class="widebuttons" id="GenerarReceta" onclick="GenerarReceta()" class="buscar">Generar Receta</Button></td>
			<td><Button class="widebuttons" id="BorrarPrescripcion" onclick="BorroUno('#datosMedicinas')" class="buscar">Borrar prescripci&oacute;n</Button></td>
			<td><Button class="widebuttons" id="LimpiarPrescripcion" onclick="BorroTodos('#datosMedicinas')" class="buscar">Limpiar prescripci&oacute;nes</Button></td>
		</tr>
		</table>
    </div>
    <div id="fragment-3">
		<SELECT id="estudios" NAME="estudios" MULTIPLE class="input">
			<option>link 1</option>
			<option>link 2</option>
		</SELECT>
		<table>
		<tr>
			<!--td><Button id="NuevoEstudio"  class="buscar" onclick="$('#dialogoEstudio').dialog('open');">Nuevo estudio</Button></td-->
			<td><Button id="VerEstudio" class="buscar">Ver estudio</Button></td>
		</tr>
		</table>
	</div>
</div>


<div id="dialogoNombre" title="Nombres de la busqueda">
	
	<SELECT id="Nombres" NAME="Nombres" class="tabla" SIZE=10>
	<!--OPTION VALUE="Juan-Camaney-Ramos">Juan-Camaney-Ramos-12/80/1973</option>
	<OPTION VALUE="Jose-Perez-Lopez">Jose-Perez-Lopez-12/80/1973</option>
	<OPTION VALUE="Jorge-De la Rosa- Lopez">Jorge-De la Rosa- Lopez-12/80/1973</option>
	<OPTION VALUE="Pedro-Perez-Lopez">Pedro-Perez-Lopez-12/80/1973</option>
	<OPTION VALUE="Pedro-Lopez-Lopez">Pedro-Lopez-Lopez-12/80/1973</option-->
	</SELECT>
    <div align="right"><button class="botonWide" onclick="Seleccionar('nombre','paterno','materno')">Seleccionar</button></div>

</div>

<div id="dialogoEstudio" title="Captura de Estudios">
  <div id="tabsEstudios">
      <ul>
            <li><a href="#captura"><span>Captura de estudios</span></a></li>
            <li><a href="#carga"><span>Carga de estudios</span></a></li>
      </ul>
	    <div id="captura">
	      <table>
		  <tr>
			<td colspan=1>Nombre:</td>			
			<td colspan=5><input id="nombreEstudio" style="width:545px"></input></td>
		  </tr>
		<tr>
		  <td>Parametro:</td>
		  <td><input id="parametro"></td>
		  <td>Resultado:</td>
		  <td><input id="resultado"></td>
		  <td>L&iacute;mite de referencia:</td>
		  <td><input id="referencia"></td>
		</tr>
		<tr>
		  <td colspan=6>
		    <div style='text-align:right'><button id="agregarEstudio"  onclick="AgregoEstudio()">Agregar</button></div>
		  </td>
		</tr>
	      </table>
	    
	      <SELECT multiple="multiple" id="datosEstudios" NAME="datosEstudios"  style="width:500; height:200">

	      </SELECT>	     		
	      <table>
		<tr style="text-align:center" >
		   
			<td><Button class="widebuttons" id="GrabarEstudio" class="buscar">Grabar Estudio</Button></td>
			<td><Button class="widebuttons" id="BorrarEstudio" onclick="BorroUno('#datosEstudios')" class="buscar">Borrar Estudio</Button></td>
			<td><Button class="widebuttons" id="LimpiarEstudio" onclick="BorroTodos('#datosEstudios')" class="buscar">Limpiar Estudios</Button></td>
		   
		</tr>
		</table>	      
	    </div>
  	    <div id="carga">
	      <table >
		  <tr>
			<td style="width:50px">Nombre:</td>			
			<td ><input id="nombreEstudio" style="width:545px"></input></td>
		  </tr>
		  <tr>
		    <td colspan=2>
		      <INPUT TYPE=FILE NAME="upfile">
		    </td>
		  </tr>
	      </table>
	    <div style="text-align:left">
	    <Button class="widebuttons" id="GrabarEstudioFile" class="buscar">Grabar Estudio</Button>
	    </div>
	    </div>
  </div>  
  </div>

<script type="text/javascript" src="media/js/jquery-1.3.2.js"></script>    
  <script type="text/javascript" src="media/js/ui.core.js"></script>
  <script type="text/javascript" src="media/js/ui.tabs.js"></script>
  <script type="text/javascript" src="media/js/ui.draggable.js"></script>
  <script type="text/javascript" src="media/js/ui.resizable.js"></script>
  <script type="text/javascript" src="media/js/ui.dialog.js"></script>
  <script type="text/javascript" src="media/js/dialogonombre.js"></script>
  <script type="text/javascript" src="media/js/registrarEstudio.js"></script>
  <script type="text/javascript">
  $(document).ready(function(){
    $("#tabs").tabs();
    $("#tabsEstudios").tabs();
    $("#nombre").focus();
	GraboCookiesPaciente("");
    DialogoNombre();
    DialogoEstudios();
  });
  
  function DialogoEstudios()
  {
    $("#dialogoEstudio").dialog( {width: 680, 
	    height: 800 , modal:true,
	    /*show: 'slide', */ hide: 'slide',
	    resizable: false, autoOpen: false});
  }

  function AgregoSintoma()
  {
	cadena=$("#sintoma").attr("value");	
	if(trim(cadena).length>0)
	{
		$("#datosSintomas").append("<option value='"+cadena+"'>"+cadena+"</option>");
		$("#sintoma").attr("value","");
	}
  }
  function AgregoMedicina()
  {
	cadena=$("#prescripcion").attr("value")+" "+$("#dosis").attr("value");
	if(trim(cadena).length>0)
	{
		$("#datosMedicinas").append("<option value='"+cadena+"'>"+cadena+"</option>");
		$("#prescripcion").attr("value","");
		$("#dosis").attr("value","");
	}
  }
  
  function GraboConsulta()
  {
    if(ID==null)
    {
      if(GetCookie("pacn")==null)
      {
	  buscoNombre();
      }
      else{
	      var paciente=GetCookie("pacn");
	      if (paciente!=null){
		str=paciente.split("=");
	      }	
	      paciente=str[1];			
	      ajax={
		  type: "get",
		  async:true,
		  dataType:"json",
		  url:"/graboconsulta/",
		  data:"paciente="+paciente,			
		  error: function ()
			  {
				  alert("Ocurrio un error con el registro de los datos de la consulta");
			  },            
			  success:GraboRestoDatos
		  };       		
		  $.ajax(ajax);//llamo la funcion con JQUERY  
      }
    }
    else
    {//Ya esta grabada entonces debe ser una actualización a los datos
      GraboComplementosConsulta();
    }
  }
  var ID;
  function GraboRestoDatos(data)
  {    
	datos=eval(data);	
	ID=datos[0].id;
      GraboComplementosConsulta();
  }
  function GraboComplementosConsulta()
  {
     $("#datosSintomas: option").each(function (i,selected){			   
	    GraboSintoma(ID,$(selected).text());	    	    
	});

       GraboDiagnostico(ID,$("#diagnostico").attr("value"));
  }
  function GraboSintoma(id,sintoma)
  {
    ajax={
	type: "post",
	async:true,
	dataType:"json",
	url:"/grabosintoma",
	data:"id="+id+"&sintoma="+sintoma
    };       		
    $.ajax(ajax);//llamo la funcion con JQUERY  
  }
  
  function GraboDiagnostico(id,diagnostico)
  {
    ajax={
	type: "post",
	async:true,
	dataType:"json",
	url:"/grabodiagnostico",
	data:"id="+id+"&diagnostico="+diagnostico
    };       		
    $.ajax(ajax);//llamo la funcion con JQUERY  
  }
  
  function GenerarReceta()
  {
    if(ID==null)
    {
	alert("Primero debe registrar los campos de la cejilla 'consulta' y dar click en el boton 'Grabar'")
    }
    else
    {
      $("#datosMedicinas: option").each(function (i,selected){	
	  GraboReceta(ID,$(selected).text());
	});
    }
  }
  
  function GraboReceta(id,prescripcion)
  {
    ajax={
	type: "post",
	async:true,
	dataType:"json",
	url:"/graboreceta",
	data:"id="+id+"&prescripcion="+prescripcion
    };       		
    $.ajax(ajax);//llamo la funcion con JQUERY  
  }
  </script>
  
{%endblock %}